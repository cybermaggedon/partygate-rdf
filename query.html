<html>
  <head>
    <style>
      table, tr, td, th {
	  border-collapse: collapse;
	  border: 1px solid black;
      }
      td {
	  padding: 5px;
      }
      th {
	  padding: 5px;
	  background-color: #e0e0e0;
      }
      BODY DIV {
	  margin: 10px;
      }
    </style>
  </head>
  <body>
<!-- 
 http://localhost:8080/query.html?query=SELECT%20%2A%20WHERE%20%7B%20?a%20?b%20?c%20.%20%7D%20LIMIT%205
-->

    <div>
      <div>
        <textarea id="query" rows="10" cols="60"></textarea>
      </div>

      <div>
	<button id="submit">Submit</button>
	<button id="sow">Suitcase of Wine party</button>
	<button id="b1">Parties attended by Boris</button>
	<button id="b2">Parties attended by Boris which broke rules</button>
      </div>

    </div>

    <div id="output">
    </div>

    <script language="JavaScript">

      function handle() {

	  var div = document.getElementById("output");

	  while (div.firstChild) {
	      div.removeChild(div.firstChild);
	  }

	  var resp = this.responseXML;

	  if (resp == null) {
	      div.appendChild(document.createTextNode(this.responseText));
	      return;
	  }

	  var elt = document.createElement("table");
	  div.appendChild(elt);

	  var tr = document.createElement("tr");
	  elt.appendChild(tr);

	  var vars = resp.getElementsByTagName("head")[0].children;
	  for (var i = 0; i < vars.length; i++) {
	      var variable = vars[i].getAttribute("name")
	      var th = document.createElement("th");
	      tr.appendChild(th);
	      th.appendChild(document.createTextNode(variable));
	  }

	  var rows = resp.getElementsByTagName("results")[0].children;

	  for (var i = 0; i < rows.length; i++) {

	      var tr = document.createElement("tr");
	      elt.appendChild(tr);

	      for (var j = 0; j < rows[i].children.length; j++) {

		  var item = rows[i].children[j];

		  var val = "";
		  var intern = item.getElementsByTagName("uri");
		  if (intern.length > 0) {
		      val = intern[0].textContent;
		  } else {
		      var intern = item.getElementsByTagName("literal");
		      if (intern.length > 0) {
			  val = intern[0].textContent;
		      }
		  }

		  var td = document.createElement("td");
		  tr.appendChild(td);
		  td.appendChild(document.createTextNode(val));


	      }

	  }

      }

      function run_query() {
	  var req = new XMLHttpRequest();
	  req.addEventListener("load", handle);
	  req.overrideMimeType("text/xml");
	  var query = document.getElementById('query').value;
	  const url = "/sparql?query=" + encodeURIComponent(query);
	  req.open("GET", url);
	  req.send();
      }

      function execute(q) {
	  document.getElementById("query").value = q;
	  run_query();
      }

      var sow = "SELECT ?label ?value\nWHERE {\n  <http://e623fd-partygate/suitcase-of-wine> ?prop ?value .\n  ?prop <http://www.w3.org/2000/01/rdf-schema#label> ?label .\n}";
//      var sow = "SELECT ?label ?value\nWHERE {\n  {\n    <http://e623fd-partygate/suitcase-of-wine> ?prop ?value .\n    FILTER (!isURI(?value))\n    ?prop <http://www.w3.org/2000/01/rdf-schema#label> ?label .\n  } UNION {\n    <http://e623fd-partygate/suitcase-of-wine> ?prop ?obj .\n    FILTER (isURI(?obj)) .\n    ?prop <http://www.w3.org/2000/01/rdf-schema#label> ?label .\n    ?obj <http://www.w3.org/2000/01/rdf-schema#label> ?value .\n  }\n}";
      var b1 = "PREFIX pgp: <http://e623fd-partygate/p#>\nPREFIX pg: <http://e623fd-partygate/>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT ?party\nWHERE {\n  ?id rdfs:label ?party .\n  ?id pgp:attended-by pg:boris .\n}\n";
      var b2 = "PREFIX pgp: <http://e623fd-partygate/p#>\nPREFIX pg: <http://e623fd-partygate/>\nPREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\nSELECT DISTINCT ?party ?breaks\n WHERE {\n  ?a rdfs:label ?party .\n  ?a pgp:contravenes ?d .\n  ?d rdfs:label ?breaks .\n  ?a pgp:attended-by pg:boris .\n}\n";
      

      document.getElementById("submit").onclick = run_query;
      document.getElementById("sow").onclick = function() { execute(sow); };
      document.getElementById("b1").onclick = function() { execute(b1); };
      document.getElementById("b2").onclick = function() { execute(b2); };

      var params = new URLSearchParams(window.location.search);
      query = params.get('query');

      execute(query);

    </script>

  </body>
</html>

